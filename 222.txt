DROP TABLE IF EXISTS `account`;
CREATE TABLE `account` (
  `account_id` int unsigned NOT NULL AUTO_INCREMENT,
  `email` varchar(50) NOT NULL,
  `phone` char(11) NOT NULL,
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `is_banned` tinyint(1) DEFAULT '0',
  PRIMARY KEY (`account_id`),
  UNIQUE KEY `email` (`email`),
  UNIQUE KEY `phone` (`phone`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

DROP TABLE IF EXISTS `auction_item`;
CREATE TABLE `auction_item` (
  `auction_id` int NOT NULL AUTO_INCREMENT,
  `item_inst_id` int NOT NULL,
  `seller_id` int unsigned NOT NULL,
  `last_bidder_id` int unsigned DEFAULT NULL,
  `start_price` int NOT NULL,
  `buy_now_price` int NOT NULL,
  `current_highest_bid` int NOT NULL DEFAULT '0',
  `end_time` datetime NOT NULL,
  `status` varchar(20) NOT NULL DEFAULT '上架中',
  PRIMARY KEY (`auction_id`),
  KEY `item_inst_id` (`item_inst_id`),
  KEY `seller_id` (`seller_id`),
  KEY `last_bidder_id` (`last_bidder_id`),
  CONSTRAINT `auction_item_ibfk_1` FOREIGN KEY (`item_inst_id`) REFERENCES `player_item` (`item_inst_id`),
  CONSTRAINT `auction_item_ibfk_2` FOREIGN KEY (`seller_id`) REFERENCES `character` (`char_id`),
  CONSTRAINT `auction_item_ibfk_3` FOREIGN KEY (`last_bidder_id`) REFERENCES `character` (`char_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

DROP TABLE IF EXISTS `character`;
CREATE TABLE `character` (
  `char_id` int unsigned NOT NULL AUTO_INCREMENT,
  `account_id` int unsigned NOT NULL,
  `char_name` varchar(20) NOT NULL,
  `level` tinyint DEFAULT '1',
  `hp_max` int DEFAULT '100',
  `attack` int DEFAULT '10',
  `defense` int DEFAULT '5',
  PRIMARY KEY (`char_id`),
  UNIQUE KEY `char_name` (`char_name`),
  KEY `account_id` (`account_id`),
  CONSTRAINT `character_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `account` (`account_id`),
  CONSTRAINT `character_chk_1` CHECK ((`level` between 1 and 100))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

DROP TABLE IF EXISTS `drop_table`;
CREATE TABLE `drop_table` (
  `drop_table_id` int unsigned NOT NULL AUTO_INCREMENT,
  `item_id` int unsigned NOT NULL,
  `drop_rate` decimal(5,2) DEFAULT NULL,
  `is_bind` tinyint(1) DEFAULT '0',
  PRIMARY KEY (`drop_table_id`),
  KEY `item_id` (`item_id`),
  CONSTRAINT `drop_table_ibfk_1` FOREIGN KEY (`item_id`) REFERENCES `item_template` (`item_id`),
  CONSTRAINT `drop_table_chk_1` CHECK ((`drop_rate` between 0 and 100))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

DROP TABLE IF EXISTS `item_template`;
CREATE TABLE `item_template` (
  `item_id` int unsigned NOT NULL AUTO_INCREMENT,
  `item_name` varchar(30) NOT NULL,
  `type` enum('武器','防具','饰品','消耗品') NOT NULL,
  `rarity` enum('白色','绿色','蓝色','紫色','橙色') NOT NULL,
  `base_attack` int DEFAULT '0',
  `base_defense` int DEFAULT '0',
  `req_level` tinyint DEFAULT '1',
  `is_bind` tinyint(1) DEFAULT '0',
  `icon_path` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`item_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

DROP TABLE IF EXISTS `map_info`;
CREATE TABLE `map_info` (
  `map_id` int unsigned NOT NULL AUTO_INCREMENT,
  `map_name` varchar(50) NOT NULL,
  `map_type` enum('新手村','野外','副本') NOT NULL,
  `is_safe_zone` tinyint(1) DEFAULT '1',
  `spawn_config` json DEFAULT NULL,
  `unlock_level` tinyint DEFAULT '1',
  `icon_path` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`map_id`),
  CONSTRAINT `map_info_chk_1` CHECK ((`unlock_level` between 1 and 100))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

DROP TABLE IF EXISTS `monster_template`;
CREATE TABLE `monster_template` (
  `monster_id` int unsigned NOT NULL AUTO_INCREMENT,
  `monster_name` varchar(30) NOT NULL,
  `monster_type` enum('普通怪','精英怪','BOSS') NOT NULL,
  `level` tinyint DEFAULT '1',
  `hp_max` int NOT NULL,
  `attack` int NOT NULL,
  `defense` int NOT NULL,
  `map_id` int unsigned NOT NULL,
  `drop_table_id` int unsigned NOT NULL,
  `move_speed` tinyint DEFAULT '1',
  PRIMARY KEY (`monster_id`),
  KEY `map_id` (`map_id`),
  KEY `drop_table_id` (`drop_table_id`),
  CONSTRAINT `monster_template_ibfk_1` FOREIGN KEY (`map_id`) REFERENCES `map_info` (`map_id`),
  CONSTRAINT `monster_template_ibfk_2` FOREIGN KEY (`drop_table_id`) REFERENCES `drop_table` (`drop_table_id`),
  CONSTRAINT `monster_template_chk_1` CHECK ((`level` between 1 and 100)),
  CONSTRAINT `monster_template_chk_2` CHECK ((`move_speed` between 1 and 5))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

DROP TABLE IF EXISTS `player_item`;
CREATE TABLE `player_item` (
  `item_inst_id` int NOT NULL AUTO_INCREMENT,
  `char_id` int DEFAULT NULL,
  `item_id` int DEFAULT NULL,
  `count` int DEFAULT NULL,
  `is_equipped` tinyint(1) DEFAULT '0',
  `enhance_level` int DEFAULT NULL,
  PRIMARY KEY (`item_inst_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

DROP TABLE IF EXISTS `skill_template`;
CREATE TABLE `skill_template` (
  `skill_id` int unsigned NOT NULL AUTO_INCREMENT,
  `skill_name` varchar(30) NOT NULL,
  `skill_type` enum('主动','被动') NOT NULL,
  `req_level` tinyint DEFAULT '1',
  `mp_cost` int DEFAULT '0',
  `skill_desc` text,
  `icon_path` varchar(100) DEFAULT NULL,
  `effect_type` enum('伤害','治疗','增益','减益') NOT NULL,
  PRIMARY KEY (`skill_id`),
  CONSTRAINT `skill_template_chk_1` CHECK ((`req_level` between 1 and 100)),
  CONSTRAINT `skill_template_chk_2` CHECK ((`mp_cost` >= 0))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;